<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ATAL 9/E - Ödev Panosu</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent1:#06b6d4;--accent2:#7c3aed;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:linear-gradient(180deg,#071026 0%, #071a2b 60%); color:#e6eef6; -webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:28px auto;padding:18px}

    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}

    /* CSS logo */
    .css-logo{width:64px;height:64px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;color:white;font-size:16px;letter-spacing:0.6px;position:relative;background:linear-gradient(135deg,var(--accent1),var(--accent2));box-shadow:0 8px 30px rgba(124,58,237,0.14);overflow:hidden}
    .css-logo::after{content:'';position:absolute;left:-40%;top:-40%;width:120%;height:120%;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), transparent 18%);transform:rotate(25deg);opacity:0.9}
    .css-logo span{position:relative;z-index:2;text-shadow:0 6px 18px rgba(2,6,23,0.6)}

    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .board{display:grid;grid-template-columns:1fr 320px;gap:18px}
    @media (max-width:900px){.board{grid-template-columns:1fr} .sidebar{order:2}}

    .days{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    @media (max-width:700px){.days{grid-template-columns:1fr}}

    .day{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6);min-height:160px}
    .day h3{display:flex;justify-content:space-between;align-items:center;margin:0 0 8px 0;font-size:15px}
    .day .list{display:flex;flex-direction:column;gap:8px}
    .task{background:var(--glass);padding:10px;border-radius:10px;color:#dff6fb;font-size:14px;display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
    .task .meta{font-size:12px;color:var(--muted)}

    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6);height:max-content}
    .new{display:flex;gap:8px;flex-direction:column}
    input, textarea, select, button{font-family:inherit}
    input, textarea, select{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:inherit}
    textarea{min-height:80px;resize:vertical}
    button{background:var(--accent1);border:none;padding:8px 10px;border-radius:10px;color:#042026;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:500}
    .small{font-size:13px;padding:6px 8px;border-radius:8px}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    .topbar{display:flex;gap:8px;align-items:center}
    .day-count{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-weight:600;color:#dff6fb}

    /* nice micro-interactions */
    .task:hover{transform:translateY(-3px);transition:transform .12s}
    .hidden{display:none}
    .muted{color:var(--muted)}
    .note{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="css-logo"><span>ATAL 9/E</span></div>
      <div>
        <h1>ATAL 9/E - Haftalık Ödev Panosu</h1>
        <p class="lead">Haftanın 5 günü için ödev ekleyin, düzenleyin. Veriler tarayıcıya ve paylaşılan sunucuya kaydedilir.</p>
      </div>
    </header>

    <main class="board">
      <section>
        <div class="topbar">
          <div class="day-count" id="weekLabel">Pazartesi → Cuma</div>
          <div style="flex:1"></div>
          <div id="status" class="small ghost">Bağlantı: Yerel</div>
        </div>

        <div style="height:14px"></div>

        <div class="days" id="daysGrid">
          <!-- JavaScript ile doldurulacak -->
        </div>
      </section>

      <aside class="sidebar">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <strong>Yeni Ödev Ekle</strong>
          <span class="muted" id="savedNote">Kaydedildi</span>
        </div>
        <div class="new">
          <label>Gün</label>
          <select id="daySelect">
            <option value="0">Pazartesi</option>
            <option value="1">Salı</option>
            <option value="2">Çarşamba</option>
            <option value="3">Perşembe</option>
            <option value="4">Cuma</option>
          </select>
          <label>Konu / Ders</label>
          <input id="subject" placeholder="Matematik, Türkçe..." />
          <label>Açıklama</label>
          <textarea id="desc" placeholder="Kısa açıklama veya sayfa numarası"></textarea>
          <div style="display:flex;gap:8px">
            <button id="addBtn">Ekle</button>
            <button id="clearBtn" class="ghost">Hepsini Temizle</button>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

          <div class="note">Eğer sunucu yapılandırılırsa (aşağıda), yapılan değişiklikler sınıfça anında görünür.</div>
        </div>
      </aside>
    </main>

    <footer>Hazırlandı — ATAL 9/E Panosu • Yerel veriler tarayıcıda saklanır; sunucu etkinse paylaşılan veriler güncellenir.</footer>
  </div>

  <script>
    const DAYS = ['Pazartesi','Salı','Çarşamba','Perşembe','Cuma'];
    const STORAGE_KEY = 'atal_9e_homework_v1';

    // --- CONFIG: Eğer paylaşım istiyorsanız buraya Firebase Realtime Database config yapıştırın ---
    // 1) https://console.firebase.google.com/ -> Yeni proje -> Realtime Database oluşturun (kuralları test için true yapabilirsiniz)
    // 2) Proje ayarlarından web uygulaması ekleyin ve aşağıdaki firebaseConfig objesini doldurun
    // 3) Realtime Database URL'sini DATABASE_URL olarak girin (ör: https://your-project-default-rtdb.firebaseio.com)

    const FIREBASE_CONFIG = null; // <-- burayı kendi config'iniz ile değiştirin veya null bırakın
    /* örnek:
    const FIREBASE_CONFIG = {
      apiKey: "...",
      authDomain: "yourproj.firebaseapp.com",
      projectId: "yourproj",
      storageBucket: "yourproj.appspot.com",
      messagingSenderId: "...",
      appId: "1:...:web:...",
      databaseURL: "https://yourproj-default-rtdb.firebaseio.com"
    }
    */

    // state
    let state = { lists: [[],[],[],[],[]] };
    const clientId = Math.random().toString(36).slice(2,9);
    let firebaseAvailable = false;
    let dbRef = null;

    // helper: utf8-safe base64 (kullanılmıyor artık, eskiden URL paylaşımı içindi)
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

    // local load/save
    function loadLocal(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){ state = JSON.parse(raw); }
      }catch(e){ console.warn('load err', e) }
    }
    function saveLocal(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); document.getElementById('savedNote').textContent='Kaydedildi'; setTimeout(()=>document.getElementById('savedNote').textContent='',900)}catch(e){console.warn(e)}
    }

    // render
    function render(){
      const grid = document.getElementById('daysGrid'); grid.innerHTML='';
      DAYS.forEach((d, i)=>{
        const col = document.createElement('div'); col.className='day';
        const h = document.createElement('h3');
        h.innerHTML = `<span>${d}</span><span class="muted">${state.lists[i].length} ödev</span>`;
        col.appendChild(h);
        const list = document.createElement('div'); list.className='list';
        state.lists[i].forEach((task, idx)=>{
          const t = document.createElement('div'); t.className='task';
          t.innerHTML = `<div><strong>${escapeHtml(task.subject || '—')}</strong><div class="meta">${escapeHtml(task.desc || '')}</div></div>
                         <div style="display:flex;flex-direction:column;gap:6px"><button class="small ghost" data-day="${i}" data-idx="${idx}" onclick="editTask(event)">Düzenle</button><button class="small" data-day="${i}" data-idx="${idx}" onclick="removeTask(event)">Sil</button></div>`;
          list.appendChild(t);
        })
        col.appendChild(list);
        grid.appendChild(col);
      })
    }

    function addTask(){
      const day = Number(document.getElementById('daySelect').value);
      const subject = document.getElementById('subject').value.trim();
      const desc = document.getElementById('desc').value.trim();
      if(!subject && !desc){ alert('En az bir başlık veya açıklama girin.'); return }
      state.lists[day].push({ subject, desc });
      document.getElementById('subject').value=''; document.getElementById('desc').value='';
      persistState();
    }

    function removeTask(e){
      const day = Number(e.target.dataset.day); const idx = Number(e.target.dataset.idx);
      if(!confirm('Bu ödevi silmek istediğine emin misin?')) return;
      state.lists[day].splice(idx,1); persistState();
    }

    function editTask(e){
      const day = Number(e.target.dataset.day); const idx = Number(e.target.dataset.idx);
      const t = state.lists[day][idx];
      const newSubject = prompt('Konu / Ders', t.subject || '') || '';
      const newDesc = prompt('Açıklama', t.desc || '') || '';
      state.lists[day][idx] = { subject:newSubject.trim(), desc:newDesc.trim() };
      persistState();
    }

    function clearAll(){
      if(!confirm('Tüm ödevleri silmek istiyor musun?')) return;
      state = { lists: [[],[],[],[],[]] }; persistState();
    }

    // persist: local + optional firebase
    function persistState(pushToRemote=true){
      // attach meta
      state._meta = { lastUpdated: Date.now(), lastWriter: clientId };
      saveLocal();
      render();
      if(firebaseAvailable && pushToRemote){
        try{
          dbRef.set(state);
          document.getElementById('status').textContent = 'Bağlantı: Senkronize edildi';
        }catch(e){ console.warn(e); document.getElementById('status').textContent = 'Bağlantı: Hata'; }
      }
    }

    // Firebase setup & listener
    function initFirebaseAndSync(){
      if(!FIREBASE_CONFIG) return;
      try{
        // load SDK
        const s1 = document.createElement('script'); s1.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js'; s1.onload = ()=>{
          const s2 = document.createElement('script'); s2.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js';
          s2.onload = ()=>{
            const app = firebase.initializeApp(FIREBASE_CONFIG);
            const db = firebase.database();
            const path = '/atal_9e_v1';
            dbRef = db.ref(path);
            firebaseAvailable = true;
            document.getElementById('status').textContent = 'Bağlantı: Sunucuya bağlanıldı';

            // initial pull from server
            dbRef.once('value').then(snap=>{
              const val = snap.val();
              if(val && Array.isArray(val.lists)){
                // if server is newer than local, take server
                const serverTime = val._meta && val._meta.lastUpdated ? val._meta.lastUpdated : 0;
                const localRaw = localStorage.getItem(STORAGE_KEY);
                const local = localRaw ? JSON.parse(localRaw) : null;
                const localTime = local && local._meta && local._meta.lastUpdated ? local._meta.lastUpdated : 0;
                if(serverTime >= localTime){ state = val; saveLocal(); render(); }
              } else {
                // send local to server if server empty
                dbRef.set(state);
              }
            }).catch(e=>console.warn(e));

            // listen for remote updates
            dbRef.on('value', (snap)=>{
              const val = snap.val();
              if(!val) return;
              const meta = val._meta || {};
              if(meta.lastWriter && meta.lastWriter === clientId) return; // bizim kendi yazdığımızı dinlemede uygulama
              state = val; saveLocal(); render();
              document.getElementById('status').textContent = 'Bağlantı: Güncellendi (sunucudan)';
            });
          };
          document.head.appendChild(s2);
        };
        document.head.appendChild(s1);
      }catch(e){ console.warn('firebase init err', e); }
    }

    // init
    document.getElementById && (function(){
      loadLocal(); render();
      document.getElementById('addBtn').addEventListener('click', addTask);
      document.getElementById('clearBtn').addEventListener('click', clearAll);

      // attempt firebase
      initFirebaseAndSync();

      // keyboard: Ctrl+S to save snapshot locally
      window.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); persistState(false); alert('Kaydedildi (yalnızca yerel).'); } })
    })();
  </script>
</body>
</html>
